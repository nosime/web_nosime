<div class="profile-container">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Đang tải thông tin profile...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-container">
    <div class="error-message">
      <i class="fas fa-exclamation-triangle"></i>
      <p>{{ error }}</p>
      <button class="retry-btn" (click)="loadProfile()">
        <i class="fas fa-refresh"></i>
        Thử lại
      </button>
    </div>
  </div>

  <!-- Profile Content -->
  <div *ngIf="user && !isLoading && !error" class="profile-content">
    <!-- Avatar Section -->
    <div class="avatar-section">
      <div class="avatar-container">
        <img
          src="/assets/logo/favicon.ico"
          [alt]="user.DisplayName || user.Username"
          class="avatar"
        />
      </div>
    </div>

    <!-- User Information Section -->
    <div class="user-info-section">
      <div class="info-header">
        <h3>Thông tin tài khoản</h3>
        <button
          class="change-password-btn"
          (click)="togglePasswordForm()"
          type="button"
        >
          <i class="fas fa-key"></i>
          {{ showPasswordForm ? "Hủy" : "Đổi mật khẩu" }}
        </button>
      </div>

      <div class="info-content">
        <!-- View Mode -->
        <div class="view-mode">
          <div class="info-item">
            <label>Tên đăng nhập:</label>
            <span>{{ user.Username }}</span>
          </div>

          <div class="info-item">
            <label>Tên hiển thị:</label>
            <span>{{ user.DisplayName || "Chưa thiết lập" }}</span>
          </div>

          <div class="info-item">
            <label>Email:</label>
            <span>{{ user.Email }}</span>
          </div>

          <div class="info-item">
            <label>Trạng thái tài khoản:</label>
            <span
              class="status"
              [class.verified]="user.IsVerified"
              [class.active]="user.IsActive"
            >
              {{ user.IsActive ? "Hoạt động" : "Bị khóa" }}
              <span *ngIf="user.IsVerified" class="verified-badge"
                >✓ Đã xác thực</span
              >
            </span>
          </div>

          <div class="info-item" *ngIf="user.IsPremium">
            <label>Gói dịch vụ:</label>
            <span class="premium-badge">Premium</span>
          </div>

          <div class="info-item" *ngIf="user.RoleName">
            <label>Vai trò:</label>
            <span class="role-badge" [class.admin]="user.RoleName === 'Admin'">
              {{ user.RoleName }}
            </span>
          </div>
        </div>

        <!-- Change Password Form -->
        <div *ngIf="showPasswordForm" class="password-form">
          <div class="form-group">
            <label for="currentPassword">Mật khẩu hiện tại:</label>
            <input
              type="password"
              id="currentPassword"
              [(ngModel)]="passwordForm.currentPassword"
              class="form-control"
              placeholder="Nhập mật khẩu hiện tại"
            />
          </div>

          <div class="form-group">
            <label for="newPassword">Mật khẩu mới:</label>
            <input
              type="password"
              id="newPassword"
              [(ngModel)]="passwordForm.newPassword"
              class="form-control"
              placeholder="Nhập mật khẩu mới"
            />
          </div>

          <div class="form-group">
            <label for="confirmPassword">Xác nhận mật khẩu mới:</label>
            <input
              type="password"
              id="confirmPassword"
              [(ngModel)]="passwordForm.confirmPassword"
              class="form-control"
              placeholder="Nhập lại mật khẩu mới"
            />
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn btn-primary"
              (click)="changePassword()"
            >
              <i class="fas fa-save"></i>
              Đổi mật khẩu
            </button>
            <button
              type="button"
              class="btn btn-secondary"
              (click)="togglePasswordForm()"
            >
              <i class="fas fa-times"></i>
              Hủy
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions">
      <h3>Hành động nhanh</h3>
      <div class="action-buttons">
        <button class="action-btn" routerLink="/yeu-thich">
          <i class="fas fa-heart"></i>
          Phim yêu thích
        </button>
        <button class="action-btn" routerLink="/xem-sau">
          <i class="fas fa-clock"></i>
          Xem sau
        </button>
        <button class="action-btn" routerLink="/lich-su">
          <i class="fas fa-history"></i>
          Lịch sử xem
        </button>
        <button class="action-btn logout-btn" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i>
          Đăng xuất
        </button>
      </div>
    </div>
  </div>
</div>
